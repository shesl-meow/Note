# Go Threads and Raft

## Preparation

> Go Memory Model: https://golang.org/ref/mem

Hanpens Before，为了深入研究同步问题而提出的概念：

- 关于一个变量 v 的读语句 `r` 与写语句 `w`，`r` 可以得到 `w` 的值需要满足以下条件：
  1. `r` does not happene before `w`;
  2. There is not other `w'` that happens before `r` and after `w`;
- 一个读语句 `v` 能够准确地捕获到某个特定的 `w` 语句的值，需要满足以下条件：
  1. `w` happends before `r`;
  2. Any other `w'` to v either hanppends before `w` or after `r`;

Initialization, 一个 golang 程序的初始化：

- 对于库 `p` 引用库 `q` 的情况，`p` 的初始化函数开始在 `q` 的初始化函数结束之前；
- 在函数 `main.main` 执行前，所有函数的 `init` 函数都应该执行完成了；

Goroutine destruction：

- Goroutine 的销毁不会被保证发生在任何事件之前（not guaranteed to happen before any event）。怎么理解这个 `happened before` 呢？比如下面这个例子：

- ```go
  var a string
  func hello() {
  	go func() { a = "hello" }()
  	print(a)
  }
  ```

  其中，`a` 的赋值语句发生在一个单独的 goroutine 中，它之后没有任何同步语句，所以它有可能不会被任何事件使用，激进一点的编译器会直接拒绝编译。

