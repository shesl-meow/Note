# 工作模式

> 参考：
>
> * [https://zh.wikipedia.org/wiki/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F#%E5%A1%AB%E5%85%85](https://zh.wikipedia.org/wiki/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F#%E5%A1%AB%E5%85%85)

## 分组密码工作模式

### 电子密码本 EBC

```
              +----------------+                    +-----------------+   
              | plaintext[0:n] |                    | plaintext[n:2n] |   
              +-------|--------+                    +-------|---------+   
                      |                                     |             
                      v                                     v             
         +-------------------------+           +-------------------------+
 key---->| block cipher encryption |   key---->| block cipher encryption |
         +------------|------------+           +------------|------------+
                      |                                     |             
                      v                                     v             
              +-----------------+                   +------------------+  
              | ciphertext[0:n] |                   | ciphertext[n:2n] |  
              +-----------------+                   +------------------+
```

### 密码分组连接 CBC

```
             +----------------+                    +-----------------+    
             | plaintext[0:n] |                    | plaintext[n:2n] |    
             +--------+-------+                    +--------+--------+    
                      |                                     |             
                      v                                     v             
 iv----------------->xor             +-------------------->xor            
                      |              |                      |             
                      v              |                      v             
         +-------------------------+ |         +-------------------------+
 key---->| block cipher encryption | | key---->| block cipher encryption |
         +------------|------------+ |         +------------|------------+
                      |              |                      |             
                      v              |                      v             
              +-----------------+    |              +------------------+  
              | ciphertext[0:n] -----+              | ciphertext[n:2n] |  
              +-----------------+                   +------------------+
```

### 密码反馈 CFB

```
                     iv                                                      
                      |              --------------------------+             
                      v              |                         v             
         +-------------------------+ |            +-------------------------+
 key---->| block cipher encryption | |    key---->| block cipher encryption |
         +------------+------------+ |            +------------+------------+
                      |              |                         |             
+----------------+    v              |  +-----------------+    v             
| plaintext[0:n] +-->xor             |  | plaintext[n:2n] +-->xor
+----------------+    |              |  +-----------------+    |             
                      v              |                         v             
              +-----------------+    |                +------------------+    
              | ciphertext[0:n] +----+                | ciphertext[n:2n] |    
              +-----------------+                     +------------------+
```

### 输出反馈 OFB

```
                     iv                                                      
                      |              --------------------------+             
                      v              |                         v             
         +-------------------------+ |            +-------------------------+
 key---->| block cipher encryption | |    key---->| block cipher encryption |
         +------------+------------+ |            +------------+------------+
                      |              |                         |
                      +--------------+                         |             
+----------------+    v                 +-----------------+    v             
| plaintext[0:n] +-->xor                | plaintext[n:2n] +-->xor            
+----------------+    |                 +-----------------+    |             
                      v                                        v             
              +-----------------+                    +------------------+    
              | ciphertext[0:n] |                    | ciphertext[n:2n] |    
              +-----------------+                    +------------------+
```

### 计数器 CTR

```
           +----------+----------+                  +----------+----------+  
           |    nonce |counter=0 |                  |    nonce |counter=1 |  
           +----------+----------+                  +----------+----------+  
                      |                                        |             
                      v                                        v             
         +-------------------------+              +-------------------------+
 key---->| block cipher encryption |      key---->| block cipher encryption |
         +------------+------------+              +------------+------------+
                      |                                        |             
+----------------+    v                 +-----------------+    v             
| plaintext[0:n] --->xor                | plaintext[n:2n] --->xor            
+----------------+    |                 +-----------------+    |             
                      v                                        v             
              +-----------------+                    +------------------+    
              | ciphertext[0:n] |                    | ciphertext[n:2n] |    
              +-----------------+                    +------------------+
```
